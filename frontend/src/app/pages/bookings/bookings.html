<div class="bg-slate-900 min-h-screen py-12 px-6">
  <div class="max-w-7xl mx-auto">

    <!-- Back to Admin Button -->
    <div class="mb-8">
      <button routerLink="/adminPage" 
              class="px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-lg
               shadow-lg transition-all flex items-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Back to Dashboard
      </button>
    </div>
    

    <h1 class="text-3xl font-bold text-white mb-10">All Bookings ({{ bookings.length }})</h1>
       
    
   


    <app-booking-form
  [schedules]="schedules"
  [fares]="fares"
  [routes]="routes"
  [vehicles]="vehicles"
  (newBookings)="addBooking($event)">
</app-booking-form>



    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div *ngFor="let b of bookings" 
           class="bg-slate-800 border border-slate-700 rounded-xl p-6 hover:border-indigo-500 transition-all relative">

        <div class="flex justify-between items-start mb-4">
          <h3 class="text-xl font-bold text-white">Booking #{{ b.bookingId }}</h3>
          <span class="px-3 py-1 rounded-full text-xs font-bold"
                [ngClass]="{
                  'bg-red-500/20 text-red-400': b.bookingStatus === 'CANCELLED',
                  'bg-green-500/20 text-green-400': b.bookingStatus === 'CONFIRMED',
                  'bg-yellow-500/20 text-yellow-400': b.bookingStatus !== 'CANCELLED' && b.bookingStatus !== 'CONFIRMED'
                }">
            {{ b.bookingStatus }}
          </span>
        </div>

        <div class="space-y-2 text-slate-300 text-sm">
          <p><span class="text-slate-400">Passenger:</span> {{ b.passengerName }}</p>
          <p><span class="text-slate-400">Phone:</span> {{ b.passengerPhone }}</p>
          <p><span class="text-slate-400">Schedule:</span> {{ b.scheduleId }}</p>
          <p><span class="text-slate-400">Seats:</span> {{ b.seats }}</p>
          <p class="text-lg font-bold text-green-400">Rs. {{ b.totalAmount }}</p>
          <p class="text-xs text-slate-500">{{ b.createdAt | date:'short' }}</p>
        </div>

        <!-- Cancellation Reason Section (Visible when this card is selected) -->
        <div *ngIf="bookingId === b.bookingId && b.bookingStatus !== 'CANCELLED'" class="mt-4 pt-4 border-t border-slate-700 animate-fade-in">
          <label class="block text-xs font-medium text-slate-400 mb-1">Cancellation Reason</label>
          <textarea 
            [(ngModel)]="cancellationReason" 
            class="w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-red-500"
            placeholder="Why are you cancelling?">
          </textarea>
        </div>

        <!-- Edit & Delete Buttons -->
        <div class="flex gap-3 mt-6 pt-4 border-t border-slate-700">
      

          <!-- Toggle Reason Input / Confirm Cancel -->
          <button  
            class="flex-1 py-2 font-medium rounded-lg transition"
            [ngClass]="bookingId === b.bookingId ? 'bg-red-700 hover:bg-red-800 text-white' : 'bg-red-600 hover:bg-red-500 text-white'"
            [disabled]="loading || b.bookingStatus === 'CANCELLED'"
            (click)="bookingId !== b.bookingId ? (bookingId = b.bookingId) : cancelBooking()"> 
            
            <span *ngIf="!loading">
              {{ bookingId === b.bookingId ? 'Confirm Cancel' : 'Cancel' }}
            </span>

            <span *ngIf="loading && bookingId === b.bookingId" class="flex items-center justify-center">
              <svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4V2m0 0l3 3m-3-3L9 5m3-3a9 9 0 000 18m0 0a9 9 0 000-18" />
              </svg>
            </span>
          </button>

          <!-- Reset Button (Shown only when in "Confirm" mode) -->
          <button *ngIf="bookingId === b.bookingId && !loading" 
                  (click)="bookingId = 0; cancellationReason = ''"
                  class="px-3 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
            âœ•
          </button>
        </div>

      </div>
    </div>

    <div *ngIf="!bookings || bookings.length === 0" class="text-center py-20 text-slate-500 text-xl">
      No bookings found.
    </div>
  </div>
</div>
